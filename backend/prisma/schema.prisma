generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  nom       String
  prenom    String
  role      String   @default("USER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  comptes   Compte[]
}

model Compte {
  id          String    @id @default(uuid())
  nom         String
  type        String
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  userId      String
  associes    Associe[]
  biens       Bien[]
  contacts    Contact[]
  assembleesGenerales AssembleeGenerale[]
  notifications Notification[]
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Associe {
  id               String   @id @default(uuid())
  nom              String
  prenom           String
  email            String?
  telephone        String?
  pourcentageParts Float
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  compteId         String
  compte           Compte   @relation(fields: [compteId], references: [id], onDelete: Cascade)
}

model Bien {
  id             String      @id @default(uuid())
  adresse        String
  ville          String
  codePostal     String
  pays           String      @default("France")
  type           String
  surface        Float
  nbPieces       Int?
  nbChambres     Int?
  etage          Int?
  prixAchat      Float
  fraisNotaire   Float?
  dateAchat      DateTime
  valeurActuelle Float?
  statut         String      @default("LIBRE")
  description    String?
  assuranceMensuelle Float?  // Assurance PNO, GLI, etc. (mensuelle)
  taxeFonciere   Float?      // Taxe foncière annuelle
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  compteId       String
  baux           Bail[]
  compte         Compte      @relation(fields: [compteId], references: [id], onDelete: Cascade)
  documents      Document[]
  factures       Facture[]
  locataires     Locataire[]
  photos         Photo[]
  prets          Pret[]
  travaux        Travaux[]
  evenementsFiscaux EvenementFiscal[]
  charges        Charge[]
}

model Photo {
  id        String   @id @default(uuid())
  url       String
  filename  String
  isPrimary Boolean  @default(false)
  ordre     Int      @default(0)  // Ajout pour l'ordre d'affichage
  createdAt DateTime @default(now())
  bienId    String
  bien      Bien     @relation(fields: [bienId], references: [id], onDelete: Cascade)
}

model Document {
  id             String    @id @default(uuid())
  nom            String
  type           String
  url            String
  filename       String
  dateDocument   DateTime?
  dateExpiration DateTime?
  createdAt      DateTime  @default(now())
  bienId         String
  bien           Bien      @relation(fields: [bienId], references: [id], onDelete: Cascade)
}

model Pret {
  id            String   @id @default(uuid())
  montant       Float
  taux          Float
  duree         Int
  mensualite    Float
  tauxAssurance Float?
  dateDebut     DateTime
  organisme     String
  numeroContrat String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  bienId        String
  bien          Bien     @relation(fields: [bienId], references: [id], onDelete: Cascade)
}

model Locataire {
  id             String    @id @default(uuid())
  typeLocataire  String    @default("ENTREPRISE")
  raisonSociale  String?
  siret          String?
  formeJuridique String?
  capitalSocial  Float?
  nom            String
  prenom         String
  email          String
  telephone      String?
  adresse        String?
  ville          String?
  codePostal     String?
  dateNaissance  DateTime?
  profession     String?
  dateEntree     DateTime?
  dateSortie     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  bienId         String?
  baux           Bail[]
  bien           Bien?     @relation(fields: [bienId], references: [id])
}

model Bail {
  id            String      @id @default(uuid())
  typeBail      String
  dateDebut     DateTime
  dateFin       DateTime?
  duree         Int
  loyerHC       Float
  charges       Float?
  depotGarantie Float?
  indexRevision String?
  statut        String      @default("ACTIF")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  bienId        String
  locataireId   String
  locataire     Locataire   @relation(fields: [locataireId], references: [id], onDelete: Cascade)
  bien          Bien        @relation(fields: [bienId], references: [id], onDelete: Cascade)
  quittances    Quittance[]
}

model Quittance {
  id             String    @id @default(uuid())
  numeroQuittance String?  @unique
  mois           Int
  annee          Int
  montantLoyer   Float
  montantCharges Float?
  montantTotal   Float
  datePaiement   DateTime?
  estPaye        Boolean   @default(false)
  createdAt      DateTime  @default(now())
  bailId         String
  bail           Bail      @relation(fields: [bailId], references: [id], onDelete: Cascade)

  @@index([numeroQuittance])
}

model Facture {
  id              String    @id @default(uuid())
  numero          String?
  fournisseur     String
  montantTTC      Float
  montantHT       Float?
  tva             Float?
  dateFacture     DateTime
  datePaiement    DateTime?
  categorie       String
  sousCategorie   String?
  description     String?
  url             String?
  filename        String?
  estPaye         Boolean   @default(false)
  estDeductible   Boolean   @default(true)
  adresseDetectee String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  bienId          String
  bien            Bien      @relation(fields: [bienId], references: [id], onDelete: Cascade)
}

model Travaux {
  id          String    @id @default(uuid())
  titre       String
  description String?
  type        String
  categorie   String?
  dateDebut   DateTime
  dateFin     DateTime?
  coutEstime  Float
  coutReel    Float?
  artisan     String?
  telephone   String?
  etat        String    @default("PLANIFIE")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  bienId      String
  bien        Bien      @relation(fields: [bienId], references: [id], onDelete: Cascade)
}

model Contact {
  id         String   @id @default(uuid())
  nom        String
  prenom     String?
  entreprise String?
  type       String
  email      String?
  telephone  String?
  adresse    String?
  siteWeb    String?
  notes      String?
  evaluation Int?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  compteId   String
  compte     Compte   @relation(fields: [compteId], references: [id], onDelete: Cascade)
}

model AssembleeGenerale {
  id           String    @id @default(uuid())
  type         String    // AGO (Ordinaire) ou AGE (Extraordinaire)
  dateAG       DateTime  // Date de l'assemblée
  titre        String?   // Ex: "AG Ordinaire 2024"
  description  String?   // Résumé des décisions
  url          String    // Chemin vers le PV PDF
  filename     String    // Nom du fichier
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  compteId     String
  compte       Compte    @relation(fields: [compteId], references: [id], onDelete: Cascade)
}

model EvenementFiscal {
  id            String    @id @default(uuid())
  type          String
  dateEcheance  DateTime
  montant       Float?
  datePaiement  DateTime?
  estPaye       Boolean   @default(false)
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  bienId        String
  bien          Bien      @relation(fields: [bienId], references: [id], onDelete: Cascade)
}

model Charge {
  id          String    @id @default(uuid())
  type        String    // COPROPRIETE, ASSURANCE_PNO, ASSURANCE_GLI, TAXE_FONCIERE, ENTRETIEN, GESTION_LOCATIVE, AUTRE
  libelle     String    // Description de la charge
  montant     Float     // Montant de la charge
  frequence   String    // MENSUELLE, TRIMESTRIELLE, SEMESTRIELLE, ANNUELLE, PONCTUELLE
  dateDebut   DateTime  // Date de début de la charge
  dateFin     DateTime? // Date de fin (optionnelle pour charges récurrentes)
  jourPaiement Int?     // Jour du mois pour le paiement (1-31) - utile pour charges mensuelles
  estActive   Boolean   @default(true) // Si la charge est active ou non
  notes       String?   // Notes supplémentaires
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  bienId      String?
  bien        Bien?     @relation(fields: [bienId], references: [id], onDelete: Cascade)
  paiements   PaiementCharge[] // Historique des paiements
}

model PaiementCharge {
  id            String    @id @default(uuid())
  datePaiement  DateTime  // Date du paiement
  montant       Float     // Montant payé
  notes         String?   // Notes (numéro de transaction, etc.)
  createdAt     DateTime  @default(now())
  chargeId      String
  charge        Charge    @relation(fields: [chargeId], references: [id], onDelete: Cascade)
}

model Notification {
  id          String    @id @default(uuid())
  type        String    // LOYER, CHARGE, BAIL, FISCAL, TRAVAUX, AUTRE
  titre       String    // Titre de la notification
  message     String    // Message détaillé
  priorite    String    @default("NORMALE") // BASSE, NORMALE, HAUTE, URGENTE
  statut      String    @default("NON_LUE") // NON_LUE, LUE
  dateEcheance DateTime? // Date d'échéance concernée (optionnelle)
  lienType    String?   // Type d'entité liée (Bien, Bail, Charge, etc.)
  lienId      String?   // ID de l'entité liée
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  compteId    String
  compte      Compte    @relation(fields: [compteId], references: [id], onDelete: Cascade)
}